{% extends '::base.html.twig' %}

{% block body %}
    <h1>Welcome to our online meditation page!</h1>

    <p>
        The meditation we practice is based on the teachings found in this booklet.<br>
        Please let us know you are here by submitting your intended time spent walking and sitting.<br>
        We normally do walking first, then sitting.<br>
    </p>

    <div class="well">
        <strong>Meditation Times</strong>
    </div>

    <div class="well">
        <strong>Total minutes of meditation</strong>
    </div>

    <h2>Meditator Shoutbox</h2>

    <div class="shoutbox">
        <div class="messages">

        </div>

        {% if app.user %}
            <form action="" method="post" id="chatForm">

                <input type="text" id="messageField" class="form-control" name="message[text]" placeholder="Your message">
                <input type="hidden" name="message[token]" value="{{ postMessageToken }}">
                <button type="submit" class="btn btn-default">Send</button>
            </form>
        {% else %}
            <form><p>Please log in to send a message.</p></form>
        {% endif %}
    </div>

    <p></p>

    <div class="well">
        <strong>Meditator List</strong>
    </div>

    <div class="well">
        <strong>Somit meditation information</strong>
    </div>

    <div class="well">
        <strong>Share page</strong>
    </div>
{% endblock %}

{% block javascripts %}
<script>
    var $messages = $('.messages');
    var $chatForm = $('#chatForm');
    var $messageField = $('#messageField');

    var updateChat = function() {
        $messages.load('{{ path('render_chats') }}');
    };

    window.setTimeout(updateChat, 5000);
    updateChat();

    $chatForm.on('submit', function(e) {
        e.preventDefault();

        $.ajax({
            type: "POST",
            url: '{{ path('post_message') }}',
            data: $chatForm.serialize(),
            success: function(data) {
                updateChat();
                $messageField.val('');
            }
        });
    });
</script>
{% endblock %}
